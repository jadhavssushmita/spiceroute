<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpiceRoute | Premium Masalas</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-orange-50 text-gray-800">

<div id="login-modal" class="fixed inset-0 bg-orange-900 bg-opacity-95 z-[100] flex items-center justify-center p-4">
    <div class="bg-white p-8 rounded-xl max-w-sm w-full shadow-2xl text-center">
        <h2 class="text-2xl font-bold mb-4 text-orange-900">SpiceRoute</h2>
        <input id="login-phone-input" type="tel" placeholder="Mobile Number" class="w-full mb-4 p-3 border rounded-lg text-center outline-none focus:ring-2 focus:ring-orange-500">
        <button onclick="handleLogin()" class="w-full bg-orange-600 text-white py-3 rounded-lg font-bold">Enter Store</button>
    </div>
</div>

<nav class="bg-orange-800 text-white p-4 sticky top-0 z-50 shadow-lg">
    <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-bold uppercase cursor-pointer" onclick="location.reload()">SpiceRoute</h1>
        <button onclick="toggleCart()" class="bg-orange-600 px-4 py-2 rounded-full font-bold">Cart (<span id="cart-count">0</span>)</button>
    </div>
</nav>

<main class="container mx-auto px-4 py-12 max-w-4xl">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="bg-white p-6 rounded-lg shadow-md border-b-4 border-orange-600 text-center">
            <h3 class="text-xl font-bold">Garam Masala (100gm)</h3>
            <p class="text-2xl font-black text-orange-800 my-4">₹100</p>
            <button onclick="addToCart('Garam Masala', 100)" class="w-full bg-orange-800 text-white py-2 rounded font-bold">Add to Cart</button>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md border-b-4 border-orange-600 text-center">
            <h3 class="text-xl font-bold">Special Masala (100gm)</h3>
            <p class="text-2xl font-black text-orange-800 my-4">₹80</p>
            <button onclick="addToCart('Special Masala', 80)" class="w-full bg-orange-800 text-white py-2 rounded font-bold">Add to Cart</button>
        </div>
    </div>
</main>

<div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center p-4 z-[110]">
    <div class="bg-white p-8 rounded-xl max-w-md w-full">
        <h2 class="text-2xl font-bold mb-4">Checkout</h2>
        <div id="cart-items" class="mb-4 text-sm border-b pb-4"></div>
        <form onsubmit="initiatePayment(event)">
            <input required id="cust-name" placeholder="Full Name" class="w-full mb-3 p-2 border rounded">
            <input required id="cust-addr" placeholder="Shipping Address" class="w-full mb-4 p-2 border rounded">
            <button type="submit" class="w-full bg-green-700 text-white py-4 rounded-lg font-bold text-lg shadow-lg">
                OPEN GOOGLE PAY
            </button>
            <button type="button" onclick="toggleCart()" class="w-full mt-3 text-gray-400 text-sm">Cancel</button>
        </form>
    </div>
</div>

<script>
let cart = [];
let userPhone = "";
const MY_GPAY_ID = "sharayuj66@oksbi";

function handleLogin() {
    const p = document.getElementById('login-phone-input').value;
    if(p.length > 5) {
        userPhone = p;
        localStorage.setItem('spicePhone', p);
        document.getElementById('login-modal').classList.add('hidden');
    }
}

function addToCart(name, price) {
    cart.push({ name, price });
    document.getElementById('cart-count').innerText = cart.length;
    alert(name + " added!");
}

function toggleCart() {
    if (cart.length === 0) { alert("Cart is empty!"); return; }
    const itemsDiv = document.getElementById('cart-items');
    let total = cart.reduce((s, i) => s + i.price, 0);
    itemsDiv.innerHTML = cart.map(i => `<div class="flex justify-between"><span>${i.name}</span><b>₹${i.price}</b></div>`).join('');
    itemsDiv.innerHTML += `<div class="font-bold text-lg pt-2 mt-2 border-t">Total: ₹${total}</div>`;
    document.getElementById('checkout-modal').classList.toggle('hidden');
}

function initiatePayment(e) {
    e.preventDefault();
    const total = cart.reduce((s, i) => s + i.price, 0);
    const orderID = 'SR' + Date.now().toString().slice(-6);

    // --- UPDATED PAYMENT LINK FOR CURRENCY & LIMIT FIX ---
    // Added mc=0000 and cu=INR specifically to handle bank limits
    const upiParams = `pa=${MY_GPAY_ID}&pn=SpiceRoute&am=${total}&cu=INR&tn=SpiceRoute-Order-${orderID}&mc=0000&mode=02`;
    
    const gpayUrl = `tez://upi/pay?${upiParams}`;
    const fallbackUpi = `upi://pay?${upiParams}`;

    window.location.href = gpayUrl;

    setTimeout(() => {
        if (document.hasFocus()) {
            window.location.href = fallbackUpi;
        }
    }, 500);
}

window.onload = () => {
    const saved = localStorage.getItem('spicePhone');
    if(saved) {
        userPhone = saved;
        document.getElementById('login-modal').classList.add('hidden');
    }
};
</script>
</body>
</html>
